!function(t,n){function e(t){var n,e;return e={xAxis:0,yAxis:0,shape:{params:{stroke:"#000000",fill:"rgba(0,0,0,0)","stroke-width":2}}},n={circle:{params:{x:0,y:0}}},n[t]&&(e.shape=A(e.shape,n[t])),e}function o(){var t=[],n=["circle","line","square","text"],e=["circle","path","rect",null],o=[null,null,null,{text:" "}],a=[{r:0,fill:"#e7f0f9",stroke:"#6688aa"},{d:["M",0,0,"L",10,10],fill:"#e7f0f9",stroke:"#6688aa"},{width:10,height:10,fill:"#e7f0f9",stroke:"#6688aa"},null],i=[k.getRadius,k.getPath,k.getRect,k.getText],s=[k.getRadiusAndUpdate,k.getPathAndUpdate,k.getRectAndUpdate,k.showInput];return m(n,function(n,r){t.push({annotationEvents:{step:i[r],stop:s[r]},annotation:{anchorX:"left",anchorY:"top",xAxis:0,yAxis:0,title:o[r],shape:{type:e[r],params:a[r]}},symbol:{shape:n,size:12,style:{"stroke-width":1,stroke:"text"==n?"black":"#6688aa",fill:"#e7f0f9",zIndex:121}},style:{fill:"black",stroke:"blue",strokeWidth:2},size:12,states:{selected:{fill:"#9BD",r:0},hover:{fill:"#9BD",r:0}}})}),{enabledButtons:!0,buttons:t}}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function i(t){return"number"==typeof t}function s(t){return t!==f&&null!==t}function r(t,n,e,o,a){for(var i=t.length,s=0,r=[];i>s;)"number"==typeof t[s]&&"number"==typeof t[s+1]?(r[s]=n.toPixels(t[s])-o,r[s+1]=e.toPixels(t[s+1])-a,s+=2):(r[s]=t[s],s+=1);return r}function l(t,n,e){var o=t.renderer.g("annotations-group-"+n);return o.attr({zIndex:7}),o.add(),o.clip(e),o}function u(t,n){var e={x:n.left,y:n.top,width:n.width,height:n.height};return t.renderer.clipRect(e)}function p(n){function e(e){var a=e.pageX-n.container.offsetLeft,i=e.pageY-n.container.offsetTop;if(n.isInsidePlot(a-n.plotLeft,i-n.plotTop)&&!n.annotations.allowZoom){var s=n.xAxis[0],r=n.yAxis[0],l=n.annotations.selected,u=$.extend(!0,{},n.annotations.options.buttons[l].annotation,{xValue:s.toValue(a),yValue:r.toValue(i),allowDragX:!0,allowDragY:!0});n.addAnnotation(u),n.drawAnnotation=n.annotations.allItems[n.annotations.allItems.length-1],t.addEvent(document,"mousemove",o)}}function o(t){var e=n.annotations.selected;n.annotations.options.buttons[e].annotationEvents.step.call(n.drawAnnotation,t)}function a(e){if(t.removeEvent(document,"mousemove",o),n.drawAnnotation){var a=n.annotations.selected;n.annotations.options.buttons[a].annotationEvents.stop.call(n.drawAnnotation,e)}n.drawAnnotation=null}t.addEvent(n.container,"mousedown",e),t.addEvent(document,"mouseup",a)}function c(t){var n=t.annotations.options.buttons;t.annotations.buttons=t.annotations.buttons||[],m(n,function(n,e){t.annotations.buttons.push(h(t,n,e))})}function h(t,n,e){var o=t.rangeSelector?t.rangeSelector.inputGroup.offset:0,a=t.renderer,i=n.symbol,s=35,r=i.size,l=n.size,u=t.plotWidth+t.plotLeft-(e+1)*s-o,p=t.plotTop-23-l,c=n.events&&n.events.click?n.events.click:d(e,t),h=n.states.selected,f=n.states.hover,n=a.button("",u,p,c,{r:0},f,h).attr({width:l,height:l,fill:"#ffffff"}),x=a.symbol(i.shape,l-r/2,l-r/2,r,r).attr(i.style).add(n);return n.attr(n.style).add(),[n,x]}function d(t,n){return function(){self=n.annotations.buttons[t][0],2==self.state?(n.annotations.selected=-1,n.annotations.allowZoom=!0,self.setState(0)):(n.annotations.selected>=0&&n.annotations.buttons[n.annotations.selected][0].setState(0),n.annotations.allowZoom=!1,n.annotations.selected=t,self.setState(2))}}var f,x,y=t,g=y.Chart,v=y.extend,A=y.merge,m=y.each;y.ALLOWED_SHAPES=["path","rect","circle"],x={top:0,left:0,center:.5,middle:.5,bottom:1,right:1},y.SVGRenderer.prototype.symbols.line=function(t,n,e,o){var a=2;return["M",t+a,n+a,"L",t+e-a,n+o-a]},y.VMLRenderer&&(y.VMLRenderer.prototype.symbols.line=y.SVGRenderer.prototype.symbols.line),y.SVGRenderer.prototype.symbols.text=function(t,n,e,o){var a=1;return["M",t,n+a,"L",t+e,n+a,"M",t+e/2,n+a,"L",t+e/2,n+a+o]},y.VMLRenderer&&(y.VMLRenderer.prototype.symbols.text=y.SVGRenderer.prototype.symbols.text),y.wrap(y.Pointer.prototype,"drag",function(t,n){(!this.chart.annotations||this.chart.annotations.allowZoom)&&t.call(this,n)}),y.wrap(y.Pointer.prototype,"onContainerMouseDown",function(t,n){t.call(this,n),this.chart.selectedAnnotation&&this.chart.selectedAnnotation.events.deselect.call(this.chart.selectedAnnotation,n)});var b=n.inArray,V=y.addEvent,w=y.VMLRenderer?!0:!1,k={getRadius:function(t){var n=this,e=n.chart,o=t.pageX-e.container.offsetLeft,a=t.pageY-e.container.offsetTop,i=e.xAxis[n.options.xAxis],s=e.yAxis[n.options.yAxis],r=Math.abs(o-i.toPixels(n.options.xValue)),l=Math.abs(a-s.toPixels(n.options.yValue));return radius=parseInt(Math.sqrt(r*r+l*l),10),n.shape.attr({r:radius}),radius},getRadiusAndUpdate:function(t){var n=k.getRadius.call(this,t);this.update({shape:{params:{r:n,x:-n,y:-n}}})},getPath:function(t){var n=this,e=n.chart,o=t.pageX-e.container.offsetLeft,a=t.pageY-e.container.offsetTop,i=e.xAxis[n.options.xAxis],s=e.yAxis[n.options.yAxis],r=o-i.toPixels(n.options.xValue),l=a-s.toPixels(n.options.yValue),u=["M",0,0,"L",parseInt(r,10),parseInt(l,10)];return n.shape.attr({d:u}),u},getPathAndUpdate:function(t){var n=this,e=n.chart,o=k.getPath.call(n,t),a=e.xAxis[n.options.xAxis],i=e.yAxis[n.options.yAxis],s=a.toValue(o[4]+a.toPixels(n.options.xValue)),r=i.toValue(o[5]+i.toPixels(n.options.yValue));this.update({xValueEnd:s,yValueEnd:r,shape:{params:{d:o}}})},getRect:function(t){var n=this,e=n.chart,o=t.pageX-e.container.offsetLeft,a=t.pageY-e.container.offsetTop,i=e.xAxis[n.options.xAxis],s=e.yAxis[n.options.yAxis],r=i.toPixels(n.options.xValue),l=s.toPixels(n.options.yValue),u=o-r,p=a-l,c=Math.round(u)+1,h=Math.round(p)+1,d={};return d.x=0>c?c:0,d.width=Math.abs(c),d.y=0>h?h:0,d.height=Math.abs(h),n.shape.attr({x:d.x,y:d.y,width:d.width,height:d.height}),d},getRectAndUpdate:function(t){var n=k.getRect.call(this,t);this.update({shape:{params:n}})},getText:function(){},showInput:function(t){var n,e=this,o=e.chart,a=o.annotationInputIndex=o.annotationInputIndex?o.annotationInputIndex:1,i=document.createElement("span");i.innerHTML='<input type="text" class="menu-btn annotation-'+a+'" placeholder="Add text"><button class="menu-btn">OK</button>',i.style.position="absolute",i.style.left=t.pageX+"px",i.style.top=t.pageY+"px",document.body.appendChild(i),i.querySelectorAll("input")[0].focus(),n=i.querySelectorAll("button")[0],n.onclick=function(){var t=this.parentNode;e.update({title:{text:t.querySelectorAll("input")[0].value}}),t.parentNode.removeChild(t)},o.annotationInputIndex++}},P=function(){this.init.apply(this,arguments)};P.prototype={init:function(t,n){var o=n.shape&&n.shape.type;this.chart=t,this.options=A({},e(o),n)},render:function(n){function e(n,e){if(s(e))for(var a in e)!function(a){t.addEvent(n.element,a,function(t){e[a].call(o,t)})}(a)}var o=this,a=this.chart,i=o.chart.renderer,r=o.group,l=o.title,u=o.shape,p=o.options,c=p.title,h=p.shape,d=p.allowDragX,f=p.allowDragY,x=(a.xAxis[p.xAxis],a.yAxis[p.yAxis],o.hasEvents),y=a.userOptions;r||(r=o.group=i.g(),r.attr({"class":"highcharts-annotation"})),!u&&h&&-1!==b(h.type,t.ALLOWED_SHAPES)&&(u=o.shape=i[p.shape.type](h.params),u.add(r)),!l&&c&&(l=o.title=i.label(c),l.add(r)),!d&&!f||x?x||(e(r,p.events),y.annotationsOptions&&y.annotationsOptions.events&&e(r,y.annotationsOptions.events)):($(r.element).on("mousedown",function(t){o.events.storeAnnotation(t,o,a),o.events.select(t,o)}),V(document,"mouseup",function(t){o.events.releaseAnnotation(t,a)}),e(r,p.events),y.annotationsOptions&&y.annotationsOptions.events&&e(r,y.annotationsOptions.events)),this.hasEvents=!0,r.add(a.annotations.groups[p.yAxis]),o.linkObjects(),n!==!1&&o.redraw()},redraw:function(n){var e,o,a,l,u,p,c=this.options,h=this.chart,d=this.group,f=this.title,y=this.shape,g=this.linkedObject,A=h.xAxis[c.xAxis],m=h.yAxis[c.yAxis],b=c.width,V=c.height,k=x[c.anchorY],P=x[c.anchorX],M=!1;if(g&&(o=g instanceof t.Point?"point":g instanceof t.Series?"series":null,"point"===o?(c.xValue=g.x,c.yValue=g.y,a=g.series):"series"===o&&(a=g),d.visibility!==a.group.visibility&&d.attr({visibility:a.group.visibility})),u=s(c.xValue)?A.toPixels(c.xValue):c.x,p=s(c.yValue)?m.toPixels(c.yValue):c.y,!isNaN(u)&&!isNaN(p)&&i(u)&&i(p)){if(f){var E=c.title;f.attr(w?{text:E.text}:E),f.css(c.title.style),M=!0}y&&(e=v({},c.shape.params),"values"===c.shape.units&&(e.width&&(e.width=A.toPixels(e.width)-A.toPixels(0)),s(e.x)&&(e.x=A.toPixels(e.x)),e.height&&(e.height=-m.toPixels(e.height)+m.toPixels(0)),s(e.y)&&(e.y=m.toPixels(e.y)),"path"===c.shape.type&&(e.d=r(e.d,A,m,u,p))),s(c.yValueEnd)&&s(c.xValueEnd)&&c.shape.d&&(e.d=e.d||c.shape.d,e.d[4]=A.toPixels(c.xValueEnd)-A.toPixels(c.xValue),e.d[5]=m.toPixels(c.yValueEnd)-m.toPixels(c.yValue)),"circle"===c.shape.type&&(e.x+=e.r,e.y+=e.r),M=!0,y.attr(e)),d.bBox=null,i(b)||(l=d.getBBox(),b=l.width),i(V)||(l||(l=d.getBBox()),V=l.height),i(P)||(P=x.center),i(k)||(k=x.center),u-=b*P,p-=V*k,this.selectionMarker&&this.events.select({},this),n&&h.animation&&s(d.translateX)&&s(d.translateY)?d.animate({translateX:u,translateY:p}):d.translate(u,p)}},destroy:function(){var t=this,n=this.chart,e=n.annotations.allItems,o=e.indexOf(t);n.activeAnnotation=null,o>-1&&e.splice(o,1),m(["title","shape","group"],function(n){t[n]&&t[n].destroy?(t[n].destroy(),t[n]=null):t[n]&&(t[n].remove(),t[n]=null)}),t.group=t.title=t.shape=t.chart=t.options=t.hasEvents=null},update:function(t,n){$.extend(!0,this.options,t),this.linkObjects(),this.render(n)},linkObjects:function(){var t=this,n=t.chart,e=t.linkedObject,o=e&&(e.id||e.options.id),a=t.options,i=a.linkedTo;s(i)?s(e)&&i===o||(t.linkedObject=n.get(i)):t.linkedObject=null},events:{select:function(t,n){var e,o=n.chart,a=o.selectedAnnotation,i=10;a&&a.selectionMarker&&a!==n&&(a.selectionMarker.destroy(),a.selectionMarker=!1),n.selectionMarker&&(n.selectionMarker.destroy(),n.group.bBox=null),e=n.group.getBBox(),n.selectionMarker=o.renderer.rect(e.x-i/2,e.y-i/2,e.width+i,e.height+i).attr({"stroke-width":1,stroke:"#696969",fill:"transparent",dashstyle:"ShortDash","shape-rendering":"crispEdges"}),n.selectionMarker.add(n.group),o.selectedAnnotation=n},deselect:function(){if(this.selectionMarker&&this.group){this.selectionMarker.destroy(),this.selectionMarker=!1,this.group.bBox=null;var t=$("#highcharts-edit-annotation:visible");t&&$(t).find(".cancel").click()}},destroyAnnotation:function(t,n){if(n.options.linkedAnnotations)for(var e=chart.annotations.allItems,o=e.length-1,a=n.options.linkedAnnotations;o>=0;o--){var i=e[o];i.options.linkedAnnotations===a&&i.destroy()}else n.destroy()},translateAnnotation:function(t,n){t.stopPropagation(),t.preventDefault();n.container;if(n.activeAnnotation){var e=t.pageX-n.container.offsetLeft,o=t.pageY-n.container.offsetTop;if(!n.isInsidePlot(e-n.plotLeft,o-n.plotTop))return;var a=n.activeAnnotation,i=a.options.allowDragX?t.pageX-a.startX+a.group.translateX:a.group.translateX,s=a.options.allowDragY?t.pageY-a.startY+a.group.translateY:a.group.translateY;a.transX=i,a.transY=s,a.group.attr({transform:"translate("+i+","+s+")"}),a.hadMove=!0}},storeAnnotation:function(t,n,e){if(e.annotationDraging||(t.stopPropagation(),t.preventDefault()),!w&&0===t.button||w&&1===t.button){var o=t.pageX,a=t.pageY;e.activeAnnotation=n,e.activeAnnotation.startX=o,e.activeAnnotation.startY=a,e.activeAnnotation.transX=0,e.activeAnnotation.transY=0,V(document,"mousemove",function(t){n.events.translateAnnotation(t,e)})}},releaseAnnotation:function(t,n){if(t.stopPropagation(),t.preventDefault(),!n.activeAnnotation||0===n.activeAnnotation.transX&&0===n.activeAnnotation.transY)n.activeAnnotation=null;else{var e=n.activeAnnotation,o=e.transX,a=e.transY,i=e.options,r=i.xValue,l=i.yValue,u=i.xValueEnd,p=i.yValueEnd,c=i.allowDragX,h=i.allowDragY,d=e.chart.xAxis[e.options.xAxis],f=e.chart.yAxis[e.options.yAxis],x=d.toValue(o),y=f.toValue(a);(0!==o||0!==a)&&(c&&h?e.update({xValue:s(r)?x:null,yValue:s(l)?y:null,xValueEnd:s(u)?u-r+x:null,yValueEnd:s(p)?p-l+y:null,x:s(r)?null:o,y:s(l)?null:a},!1):c?e.update({xValue:s(r)?x:null,yValue:s(l)?l:null,xValueEnd:s(u)?u-r+x:null,yValueEnd:s(p)?p:null,x:s(r)?null:o,y:s(l)?null:e.options.y},!1):h&&e.update({xValue:s(r)?r:null,yValue:s(l)?y:null,xValueEnd:s(u)?u:null,yValueEnd:s(p)?p-l+y:null,x:s(r)?null:e.options.x,y:s(l)?null:a},!1)),n.activeAnnotation=null,n.redraw(!1)}}}},v(g.prototype,{addAnnotation:function(t,n){var e,o,i=this,s=i.annotations.allItems;for(a(t)||(t=[t]),o=t.length;o--;)e=new P(i,t[o]),s.push(e),e.render(n)},redrawAnnotations:function(){for(var t=this,n=t.yAxis,e=n.length,o=t.annotations,a=0;e>a;a++){var i=n[a],s=o.clipPaths[a];if(s)s.attr({x:i.left,y:i.top,width:i.width,height:i.height});else{var r=u(t,i);o.clipPaths.push(r),o.groups.push(l(t,a,r))}}m(t.annotations.allItems,function(t){t.redraw()}),m(t.annotations.buttons,function(n,e){var o=t.rangeSelector?t.rangeSelector.inputGroup.offset:0,a=t.plotWidth+t.plotLeft-35*(e+1)-o;n[0].attr({x:a})})}}),g.prototype.callbacks.push(function(n){for(var e=n.options.annotations,i=n.yAxis,s=i.length,r=[],h=[],d=0;s>d;d++){var f=i[d],x=u(n,f);r.push(x),h.push(l(n,d,x))}n.annotations||(n.annotations={}),n.annotations.allItems||(n.annotations.allItems=[]),n.annotations.allowZoom=!0,n.annotations.chart=n,n.annotations.groups=h,n.annotations.clipPaths=r,a(e)&&e.length>0&&n.addAnnotation(n.options.annotations),n.annotations.options=A(o(),n.options.annotationsOptions?n.options.annotationsOptions:{}),n.annotations.options.enabledButtons?(c(n),p(n)):n.annotations.buttons=[],t.addEvent(n,"redraw",function(){n.redrawAnnotations()})}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var n=Object(this),e=n.length>>>0;if(0===e)return-1;var o=0;if(arguments.length>1&&(o=Number(arguments[1]),o!=o?o=0:0!=o&&1/0!=o&&o!=-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=e)return-1;for(var a=o>=0?o:Math.max(e-Math.abs(o),0);e>a;a++)if(a in n&&n[a]===t)return a;return-1})}(Highcharts,HighchartsAdapter);
