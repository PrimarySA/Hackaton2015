(function(d){function y(a){return a!==h&&null!==a}function q(a){a.indicators&&(l(a.indicators,function(a,c){a.isDirtyData=!0}),l(a.chart.yAxis,function(a,c){a.render()}))}var h,v=d.Chart,z=d.Axis,w=d.extend,l=d.each,u=d.merge;d.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.isObject=function(a){return"object"===typeof a};d.splat=function(a){return d.isArray(a)?a:[a]};d.setOptions({tooltip:{followPointer:!0}});d.wrap(d.Chart.prototype,"setSize",function(a,b,c,e){a.call(this,
b,c,!1);this.alignAxes&&(this.updateHeightAxes(20,!1,!1),this.redraw(e))});d.wrap(d.Series.prototype,"update",function(a,b,c){var e=[],d=this,f,k;if(d.indicators){for(f=d.indicators.length;f--;)k=d.indicators[f],e.push(k.options),k.destroy();a.call(this,b,c);d=this;for(f=e.length;f--;)d.chart.addIndicator(e[f])}else a.call(this,b,c)});d.wrap(d.Series.prototype,"remove",function(a,b,c){var e;if(this.indicators){for(e=this.indicators.length;e--;)this.indicators[e].destroy();this.indicators=null}a.call(this,
b,c)});d.wrap(d.Series.prototype,"setData",function(a,b,c){q(this);a.call(this,b,c)});d.wrap(d.Series.prototype,"addPoint",function(a,b,c,e,d){q(this);a.call(this,b,c,e,d)});d.wrap(d.Series.prototype,"setVisible",function(a,b,c){var e=(b=b===h?this.isVisible===h?!this.visible:!this.isVisible:b)?"show":"hide",d=this;d.indicators?(d.isVisible=b,d.hideInTooltip=!b,a.call(d,!0,!0),d.chart.legend&&d.chart.legend.options.enabled&&d.chart.legend.colorizeItem(this,b),l(["group","dataLabelsGroup","markerGroup",
"tracker"],function(a){if(d[a])d[a][e]()}),d.visible=!0):a.call(d,b,!0)});d.wrap(d.Point.prototype,"update",function(a,b,c){q(this.series);a.call(this,b,c)});d.wrap(d.Point.prototype,"remove",function(a,b,c,e){q(this.series);a.call(this,b,c)});d.wrap(d.Axis.prototype,"render",function(a){function b(){var a=!1,b=Infinity,c=-Infinity;l(this.indicators,function(e,d){e.visible&&(a=!0,b=Math.min(b,e.options.yAxisMin),c=Math.max(c,e.options.yAxisMax))});a&&Infinity!==c&&-Infinity!==b?(this.isDirtyExtremes=
this.isDirty=!0,this.userMax=c,this.userMin=b):this.userMin=this.userMax=null;return a}var c;if(this.indicators&&!this.hasVisibleSeries){if(c=b.call(this),this.hasData="function"==typeof this.hasData?function(){return c}:c,"function"==typeof this.hasData&&this.hasData()||"function"!==typeof this.hasData&&this.hasData)this.setScale(),this.setTickPositions(!0),this.chart.getMargins(),d.each(this.indicators,function(a,b){a.drawGraph()})}else if(this.indicators){var e=!1;l(this.series,function(a,b){if(a.isVisible||
a.isVisible===h&&a.visible)e=!0});e?this.userMin=this.userMax=null:e=b.call(this);e&&(this.setScale(),this.setTickPositions(!0),this.chart.getMargins());this.hasData="function"==typeof this.hasData?function(){return e}:e;d.each(this.indicators,function(a,b){a.drawGraph()})}a.call(this)});d.wrap(d.Tooltip.prototype,"defaultFormatter",function(a,b){var c=this.points||d.splat(this),e;e=[b.tooltipFooterHeaderFormatter(c[0])];e=e.concat(b.bodyFormatter(c));e.push(b.tooltipFooterHeaderFormatter(c[0],!0));
return e.join("")});d.wrap(d.Tooltip.prototype,"bodyFormatter",function(a,b){return d.map(b,function(a){var b=a.series.tooltipOptions;return(b.pointFormatter||a.point.tooltipFormatter).call(a.point,b.pointFormat)})});d.wrap(d.Point.prototype,"tooltipFormatter",function(a,b){var c=this.series,e=c.indicators,g=c.tooltipOptions,f=c.chart.tooltip.options,k=d.pick(g.valueDecimals,""),x=g.valuePrefix||"",p=g.valueSuffix||"",n=this.x,m=0,t=0,l,q,r;d.each(c.pointArrayMap||["y"],function(a){a="{point."+a;
if(x||p)b=b.replace(a+"}",x+a+"}"+p);b=b.replace(a+"}",a+":,."+k+"f}")});e&&e!==h&&f.enabledIndicators&&d.each(e,function(a,c){"undefined"!==typeof a.values&&!1!==a.visible&&d.each(a.values,function(c,e){if(c[0]===n)if(a.options.tooltip)t=c.length,l=a.options.tooltip,q=l.pointFormat,b+=d.format(q,{point:{bottomColor:3<t?a.graph[2].element.attributes.stroke.value:"",bottomLine:d.numberFormat(c[3],3),x:c[0],y:3<t?d.numberFormat(c[2],3):d.numberFormat(c[1],3),color:3<t?a.graph[1].element.attributes.stroke.value:
a.graph[0].element.attributes.stroke.value,topLine:d.numberFormat(c[1],3),topColor:a.graph[0].element.attributes.stroke.value},series:a});else for(m=a.graph.length,r=0;r<m;r++)b+='<span style="font-weight:bold;color:'+a.graph[r].element.attributes.stroke.value+';">'+d.splat(a.options.names||a.name)[r]+"</span>: "+d.numberFormat(c[r+1],3)+"<br/>"})});return d.format(b,{point:this,series:this.series})});d.wrap(d.Legend.prototype,"getAllItems",function(a){var b=a.call(this);(a=this.chart.indicators)&&
d.each(a.allItems,function(a,e){a.options.showInLegend&&b.push(a)});return b});d.wrap(d.Legend.prototype,"renderItem",function(a,b){if(b instanceof Indicator){var c=b.series;b.series=null;b.color=b.options.styles.stroke;a.call(this,b);b.series=c}else a.call(this,b)});d.wrap(d.Point.prototype,"getLabelConfig",function(a,b,c){b=this;return{x:b.category,y:b.y,indicators:b.indicators,key:b.name||b.category,series:b.series,point:b,percentage:b.percentage,total:b.total||b.stackTotal}});d.wrap(d.Point.prototype,
"init",function(a,b,c,e){this.series=b;this.color=b.color;this.applyOptions(c,e);this.pointAttr={};this.indicators={};b.options.colorByPoint&&(a=b.options.colors||b.chart.options.colors,this.color=this.color||a[b.colorCounter++],b.colorCounter===a.length&&(b.colorCounter=0));b.chart.pointCount++;return this});d.wrap(d.Legend.prototype,"setItemEvents",function(a,b,c,e,d,f){a.call(this,b,c,e,d,f);(e?c:b.legendGroup).on("mouseout",function(){c.css(b.isVisible===h?b.visible?d:f:b.isVisible?d:f);b.setState()})});
window.Indicator=function(){this.init.apply(this,arguments)};Indicator.prototype={init:function(a,b){Indicator.prototype[b.type]||window.console&&console.error("Indicator: "+b.type+" not found!");b.params=u({},Indicator.prototype[b.type].getDefaultOptions(),b.params);this.chart=a;this.options=b;this.series=a.get(b.id);this.name=b.name===h?b.type:b.name;this.visible=b.visible===h?!0:b.visible;this.series.indicators||(this.series.indicators=[]);this.series.indicators.push(this)},render:function(a){a=
this.chart;var b=a.renderer,c=this.graph,e=this.group,d=this.options,f=this.series;if(this.visible){e||(this.group=e=b.g().add(a.indicators.group));if(!f)return window.console&&console.error("Series not found"),!1;if(!c){(c=Indicator.prototype[d.type].getValues(a,{points:[]},d,[f.xData,f.yData]))||(c={values:[[]],xData:[[]],yData:[[]]});this.values=this.currentPoints=c.values;this.xData=c.xData;this.yData=c.yData;this.groupPoints(f);if(this.graph=c=Indicator.prototype[d.type].getGraph(a,f,d,this.values))for(d=
c.length,f=0;f<d;f++)c[f].add(e);this.options.Axis&&(this.options.Axis.indicators=this.options.Axis.indicators||[],this.options.Axis.indicators.push(this),this.clipPath&&this.clipPath.destroy(),this.clipPath=b.clipRect({x:this.options.Axis.left,y:this.options.Axis.top,width:this.options.Axis.width,height:this.options.Axis.height}),e.clip(this.clipPath))}a.legend&&a.legend.options.enabled&&a.legend.render()}},redraw:function(){var a=this.options,b=this.chart,c=this.series,d=this.isDirtyData;this.visible?
(d&&((a=Indicator.prototype[a.type].getValues(b,{points:[]},a,[c.xData,c.yData]))||(a={values:[[]],xData:[[]],yData:[[]]}),this.values=this.currentPoints=a.values,this.xData=a.xData,this.yData=a.yData),this.groupPoints(c)):(a.yAxisMax=null,a.yAxisMin=null,this.values=[[]])},drawGraph:function(){var a=this.graph,b=a.length,c;if(a)for(c=0;c<b;c++)a[c].destroy();if(this.graph=Indicator.prototype[this.options.type].getGraph(this.chart,this.series,this.options,this.values))for(this.clipPath.attr({x:this.options.Axis.left,
y:this.options.Axis.top,width:this.options.Axis.width,height:this.options.Axis.height}),c=0;c<b;c++)this.graph[c].add(this.group)},groupPoints:function(a){var b=a.cropStart,c,e=d.splat(this.options.params.period)[0];c=Math.max(0,b-e-1);var g=a.options.data.length,f=[],k=[],f=a.xAxis,h,p,n;a.currentDataGrouping?(c=f.getExtremes(),g=c.min,h=c.max,n=a.processedXData.slice(),c=this.getCropEnd(b,h,this.xData),f.options.ordinal&&f.getGroupIntervalFactor(g,h,a),a=a.xAxis.getTimeTicks(a.currentDataGrouping,
g,h,f.options.startOfWeek,n,a.closestPointRange),f=this.groupData(this.xData.slice(Math.max(0,b-e),c),this.yData.slice(Math.max(0,b-e),c),a.slice(),this.options.params.approximation),this.processedXData=f[0],this.processedYData=p=f[1]):(this.processedXData=this.xData.slice(c,g),this.processedYData=p=this.yData.slice(c,g));d.each(this.processedXData,function(a,b){d.isArray(p[b])?k.push([a].concat(p[b])):k.push([a,p[b]])});this.options.yAxisMin=Math.min.apply(null,Array.prototype.concat.apply([],this.processedYData));
this.options.yAxisMax=Math.max.apply(null,Array.prototype.concat.apply([],this.processedYData));this.values=k;this.applyTooltipPoints()},groupData:function(a,b,c,e){var g=[],f=[],k,l=a.length,p,n=[[],[],[],[]];e="function"===typeof e?e:d.approximations[e];var m;for(m=0;m<=l&&!(a[m]>=c[0]);m++);for(;m<=l;m++){for(;(c[1]!==h&&a[m]>=c[1]||m===l)&&(p=c.shift(),k=e.apply(0,n),k!==h&&(g.push(p),f.push(k)),n[0]=[],n[1]=[],n[2]=[],n[3]=[],m!==l););if(m===l)break;k=b[m];null===k?n[0].hasNulls=!0:"number"===
typeof k?n[0].push(k):d.each(k,function(a,b){n[b].push(a)})}return[g,f]},applyTooltipPoints:function(){var a=this.values,b=this.series.points,c=b?b.length:0,d=c-a.length,g,f;for(f=d;f<c;f++)(g=b[f])&&(g.indicators[this.options.type]=a[f-d])},getCropEnd:function(a,b,c){for(var d=c.length;a<d&&!(c[a]>=b);)a++;return a+1},destroy:function(a){var b=this,c=this.chart,d=c.indicators.allItems,g=d.indexOf(b),f=this.options.Axis;-1<g&&d.splice(g,1);g=b.series.indicators.indexOf(b);-1<g&&b.series.indicators.splice(g,
1);g=f.indicators.indexOf(b);-1<g&&f.indicators.splice(g,1);b.legendGroup&&(b.legendGroup.destroy(),c.legend&&c.legend.options.enabled&&c.legend.render());f&&0===f.series.length&&f.indicators&&0===f.indicators.length&&(f.remove(),this.options.Axis=h,c.indicators.haveAxes--,c.alignAxes&&c.updateHeightAxes(20,!1,!0));b.group&&(b.group.destroy(),b.group=null);l(b.series.points,function(a){a&&a.indicators&&a.indicators[b.options.type]&&delete a.indicators[b.options.type]});b=null;c.redraw(a)},setState:function(a){},
setVisible:function(a,b){var c=this.visible,d;a===h?(d=c?!1:!0,c=c?"hide":"show"):c=(d=a)?"show":"hide";this.options.showInLegend&&this.chart.legend.colorizeItem(this,d);this.visible=d;this[c]();this.redraw();this.options.Axis&&this.options.Axis.render()},drawLegendSymbol:function(a){var b=this.options,c=a.symbolWidth,d=this.chart.renderer,g=this.legendGroup;a=a.baseline-Math.round(.3*d.fontMetrics(a.options.itemStyle.fontSize,this.legendItem).b);var f;f={"stroke-width":b.lineWidth||2};b.styles&&
b.styles.dashstyle&&(f.dashstyle=b.styles.dashstyle);this.legendLine=d.path(["M",0,a,"L",c,a]).attr(f).add(g)},update:function(a,b){u(!0,this.options,a);this.redraw(b);this.options.Axis.render()},hide:function(){this.group.hide();this.visible=!1},show:function(){this.group.show();this.visible=!0}};w(v.prototype,{addIndicator:function(a,b){var c=this.indicators.allItems,d;d=new Indicator(this,a);c.push(d);d.render(b);this.redraw(b);return d},redrawIndicators:function(){l(this.indicators.allItems,function(a){a.redraw()});
l(this.yAxis,function(a){a.render()})},updateHeightAxes:function(a,b,c){var d=this.yAxis,g=d.length,f=g,k=0,h=this.chartHeight-this.plotTop-this.marginBottom,l=0;if(!0===c||this.indicators&&0!=this.indicators.haveAxes&&0!==this.indicators.allItems.length){!b&&this.options.navigator.enabled?f--:b&&!this.options.navigator.enabled&&f++;for(b=(h-(f-1)*a)/f;k<g;k++)f=d[k],"navigator-y-axis"!==f.options.id&&(c=this.plotTop+l*(a+b),f.top===c&&f.height===b||d[k].update({top:c,height:b},!1),l++);return b}}});
w(z.prototype,{addAxisPane:function(a,b){a.indicators.haveAxes++;var c,d=a.options.navigator.enabled?a.yAxis.length-1:a.yAxis.length;a.alignAxes?(c=a.updateHeightAxes(20,!0),c={labels:{align:"left",x:2,y:-2},offset:a.alignAxes?0:null,height:c,top:a.plotTop+d*(20+c),min:0,max:100}):c={min:0,max:100};c=u(c,b);a.preventIndicators=!0;a.addAxis(c,!1,!0,!1);a.preventIndicators=!1;return a.yAxis.length-1},minInArray:function(a){return a.reduce(function(a,c){return Math.min(a,c[1])},Infinity)},maxInArray:function(a){return a.reduce(function(a,
c){return Math.max(a,c[1])},-Infinity)}});v.prototype.callbacks.push(function(a){var b=a.options.indicators,c=b?b.length:0,d=0,g=!0,d=a.renderer.g("indicators");d.attr({zIndex:2});d.add();a.indicators||(a.indicators={});a.indicators.allItems||(a.indicators.allItems=[]);a.indicators.chart=a;a.indicators.group=d;a.indicators.haveAxes=0;a.alignAxes=y(a.options.chart.alignAxes)?a.options.chart.alignAxes:!0;for(d=0;d<c;d++)a.addIndicator(b[d],!1),a.get(b[d].id).data.length-1<=b[d].params.period&&(g=!1);
Highcharts.addEvent(a,"redraw",function(){a.preventIndicators||a.redrawIndicators();a.preventIndicators=!1});g&&0<c&&a.series&&0<a.series.length&&(a.isDirtyLegend=!0,a.series[0].isDirty=!0,a.series[0].isDirtyData=!0,a.redraw(!1))});d.approximations={sum:function(a){var b=a.length,c;if(!b&&a.hasNulls)c=null;else if(b)for(c=0;b--;)c+=a[b];return c},average:function(a){var b=a.length;a=d.approximations.sum(a);"number"===typeof a&&b&&(a/=b);return a},open:function(a){return a.length?a[0]:a.hasNulls?null:
h},high:function(a){return a.length?d.arrayMax(a):a.hasNulls?null:h},low:function(a){return a.length?d.arrayMin(a):a.hasNulls?null:h},close:function(a){return a.length?a[a.length-1]:a.hasNulls?null:h},ohlc:function(a,b,c,e){a=d.approximations.open(a);b=d.approximations.high(b);c=d.approximations.low(c);e=d.approximations.close(e);if("number"===typeof a||"number"===typeof b||"number"===typeof c||"number"===typeof e)return[a,b,c,e]},range:function(a,b){a=d.approximations.low(a);b=d.approximations.high(b);
if("number"===typeof a||"number"===typeof b)return[a,b]}}})(Highcharts);