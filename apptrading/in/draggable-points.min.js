!function(e){function a(e,a,t){var o=a.options,s=i(o["dragMin"+t],void 0),n=i(o["dragMax"+t],void 0);return s>e?e=s:e>n&&(e=n),e}var t=e.addEvent,o=e.each,i=e.pick;e.dragdrop={mouseDown:function(e,a){var t,o=a.hoverPoint;o&&(t=o.series.options,t.draggableX&&(dragPoint=o,dragX=e.changedTouches?e.changedTouches[0].pageX:e.pageX,dragPlotX=dragPoint.plotX),t.draggableY&&(dragPoint=o,dragY=e.changedTouches?e.changedTouches[0].pageY:e.pageY,dragPlotY=dragPoint.plotY+(a.plotHeight-(dragPoint.yBottom||a.plotHeight))),dragPoint&&(a.mouseIsDown=!1))}},e.Chart.prototype.callbacks.push(function(e){function o(a){var t,o=e.hoverPoint,i=a.originalEvent||a;o&&(t=o.series.options,t.draggableX&&(n=o,r=i.changedTouches?i.changedTouches[0].pageX:a.pageX,d=n.plotX),t.draggableY&&(n=o,g=i.changedTouches?i.changedTouches[0].pageY:a.pageY,h=n.plotY+(e.plotHeight-(n.yBottom||e.plotHeight))),n&&(e.mouseIsDown=!1))}function i(t){if(t.preventDefault(),n){var o,i=t.originalEvent||t,p=i.changedTouches?i.changedTouches[0].pageX:t.pageX,c=i.changedTouches?i.changedTouches[0].pageY:t.pageY,l=g-c,u=r-p,v=n.series.options.draggableX,x=n.series.options.draggableY,y=n.series,m="bubble"===y.type||"scatter"===y.type,Y=m?d-u:d-u-n.series.xAxis.minPixelPadding,X=e.plotHeight-h+l,b=void 0===r?n.x:n.series.xAxis.translate(Y,!0),T=void 0===g?n.y:n.series.yAxis.translate(X,!0);b=a(b,y,"X"),T=a(T,y,"Y"),n.firePointEvent("drag",{newX:v?b:n.x,newY:x?T:n.y},function(){o=!0;var e=y.xData.indexOf(n.x),a=Math.min(y.yAxis.height,Math.max(n.plotY-l,0));T=n.series.yAxis.toValue(a+y.chart.plotTop),n.x=v?b:n.x,n.y=x?T:n.y,y.yData[e]=n.y,n.graphic.attr({y:a-4}),y.graphPath.splice(3*(e+1)-1,1,a),y.graph.attr({d:y.graphPath})}),o||s()}}function s(t){if(n){if(t){var o=t.originalEvent||t,i=o.changedTouches?o.changedTouches[0].pageX:t.pageX,s=o.changedTouches?o.changedTouches[0].pageY:t.pageY,p=n.series.options.draggableX,c=n.series.options.draggableY,l=r-i,u=g-s,v=n.series,x="bubble"===v.type||"scatter"===v.type,y=x?d-l:d-l-n.series.xAxis.minPixelPadding,m=e.plotHeight-h+u,Y=v.xAxis,X=v.yAxis,b=void 0===r?n.x:Y.translate(y,!0),T=void 0===g?n.y:X.translate(m,!0);b=a(b,v,"X"),T=a(T,v,"Y"),n.update({x:p?b:n.x,y:c?Math.max(Math.min(T,X.max),X.min):n.y},!0,!1)}n.firePointEvent("drop")}n=r=g=void 0}var n,r,g,d,h,p=e.container;e.redraw(),t(p,"mousemove",i),t(p,"touchmove",i),t(p,"mousedown",o),t(p,"touchstart",o),t(document,"mouseup",s),t(document,"touchend",s),t(p,"mouseleave",s)}),e.wrap(e.seriesTypes.column.prototype,"drawTracker",function(e){var a=this,t=a.options;e.apply(a),(t.draggableX||t.draggableY)&&o(a.points,function(e){e.graphic.attr(e.shapeArgs.height<3?{stroke:"black","stroke-width":2,dashstyle:"shortdot"}:{"stroke-width":a.options.borderWidth,dashstyle:a.options.dashStyle||"solid"})})})}(Highcharts);
